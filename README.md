
# ğŸ›ï¸ Go Microservices Ecommerce System (Goå¾®æœåŠ¡ç”µå•†ç³»ç»Ÿ)

åŸºäº **Go (Gin + gRPC)** æ„å»ºçš„é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€ä¼ä¸šçº§å¾®æœåŠ¡ç”µå•†ç³»ç»Ÿã€‚

æœ¬é¡¹ç›®æ¶µç›–äº†ç”µå•†ç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡åœºæ™¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·ã€å•†å“æœç´¢ã€è´­ç‰©è½¦ã€è®¢å•ã€æ”¯ä»˜ã€åœ°å€ç®¡ç†ï¼Œä»¥åŠ  **é«˜å¹¶å‘ç§’æ€ï¼ˆSeckillï¼‰** ã€‚é‡‡ç”¨äº†ä¸»æµçš„å¾®æœåŠ¡æ²»ç†æŠ€æœ¯æ ˆï¼Œå¦‚ **Consul** æœåŠ¡å‘ç°ã€**Sentinel** é™æµã€**Jaeger** é“¾è·¯è¿½è¸ªã€**RabbitMQ** æ¶ˆæ¯å‰Šå³°ä¸æ­»ä¿¡é˜Ÿåˆ—ã€**Elasticsearch** å…¨æ–‡æ£€ç´¢ã€**Redis + Lua** åŸå­åº“å­˜æ‰£å‡ã€‚

## ğŸš€ é¡¹ç›®äº®ç‚¹ (Key Features)

* **å¾®æœåŠ¡æ¶æ„** ï¼šåŸºäº DDD é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œæ‹†åˆ†ä¸ºç½‘å…³ã€ç”¨æˆ·ã€å•†å“ã€è®¢å•ã€è´­ç‰©è½¦ã€æ”¯ä»˜ã€åœ°å€ç­‰ 7 ä¸ªå¾®æœåŠ¡ã€‚
* **é«˜å¹¶å‘ç§’æ€è§£å†³æ–¹æ¡ˆ** ï¼š
* **æµé‡å‰Šå³°** ï¼šä½¿ç”¨ RabbitMQ å¼‚æ­¥å¤„ç†ä¸‹å•è¯·æ±‚ï¼Œå¹³æ»‘æµé‡æ³¢å³°ã€‚
* **æŠ—å‹é»‘ç§‘æŠ€** ï¼šRedis + Lua è„šæœ¬å®ç°åŸå­æ€§åº“å­˜æ‰£å‡ï¼Œå½»åº•é˜²æ­¢è¶…å–ã€‚
* **æœåŠ¡ä¿æŠ¤** ï¼šæ¥å…¥ **Sentinel** å®ç°ç½‘å…³å±‚ QPS é™æµï¼Œä¿æŠ¤ä¸‹æ¸¸æœåŠ¡ã€‚
* **é«˜æ€§èƒ½æœç´¢å¼•æ“** ï¼š
* é›†æˆ  **Elasticsearch 7.x** ï¼Œå®ç°å•†å“å…³é”®è¯æ¯«ç§’çº§å…¨æ–‡æ£€ç´¢ã€å…³é”®è¯é«˜äº®ã€‚
* æ”¯æŒæœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨å°† MySQL æ•°æ®å…¨é‡åŒæ­¥è‡³ ESã€‚
* **è®¢å•é«˜çº§ç‰¹æ€§** ï¼š
* **è¶…æ—¶è‡ªåŠ¨å–æ¶ˆ** ï¼šåŸºäº RabbitMQ **æ­»ä¿¡é˜Ÿåˆ— (DLX)** å®ç°è®¢å• 60ç§’ï¼ˆæ¼”ç¤ºç”¨ï¼‰æœªæ”¯ä»˜è‡ªåŠ¨å…³é—­è®¢å•å¹¶å›æ»šåº“å­˜ã€‚
* **å¯è§‚æµ‹æ€§** ï¼š
* é›†æˆ **OpenTelemetry** ä¸  **Jaeger** ï¼Œå®ç°å…¨é“¾è·¯åˆ†å¸ƒå¼è¿½è¸ªï¼Œå¯è§†åŒ–è¯·æ±‚è°ƒç”¨é“¾ä¸è€—æ—¶åˆ†æã€‚
* **å®¹å™¨åŒ–éƒ¨ç½²** ï¼š
* å…¨å¥—ç¯å¢ƒ (MySQL, Redis, RabbitMQ, ES, Consul, Jaeger) åŠå¾®æœåŠ¡æ”¯æŒä¸€é”® Docker Compose éƒ¨ç½²ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ (Tech Stack)

| **ç±»åˆ«**     | **æŠ€æœ¯ç»„ä»¶**      | **è¯´æ˜**                     |
| ------------------ | ----------------------- | ---------------------------------- |
| **ç¼–ç¨‹è¯­è¨€** | Go (Golang)             | 1.20+                              |
| **Web æ¡†æ¶** | Gin                     | é«˜æ€§èƒ½ HTTP Web æ¡†æ¶ (Gateway)     |
| **RPC æ¡†æ¶** | gRPC + Protobuf         | å¾®æœåŠ¡é—´çš„é«˜æ•ˆé€šä¿¡                 |
| **æœåŠ¡å‘ç°** | Hashicorp Consul        | æœåŠ¡æ³¨å†Œä¸å‘ç°ã€å¥åº·æ£€æŸ¥           |
| **æ•°æ®åº“**   | MySQL 8.0               | æ ¸å¿ƒä¸šåŠ¡æ•°æ®å­˜å‚¨ (GORM ORM)        |
| **ç¼“å­˜**     | Redis 7.0               | ç¼“å­˜ã€åˆ†å¸ƒå¼é”ã€ç§’æ€åº“å­˜è®¡æ•°       |
| **æ¶ˆæ¯é˜Ÿåˆ—** | RabbitMQ                | å¼‚æ­¥è§£è€¦ã€æµé‡å‰Šå³°ã€å»¶è¿Ÿé˜Ÿåˆ— (DLX) |
| **æœç´¢å¼•æ“** | Elasticsearch 7.17      | å•†å“å…¨æ–‡æ£€ç´¢                       |
| **é™æµç†”æ–­** | Sentinel                | æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§                 |
| **é“¾è·¯è¿½è¸ª** | Jaeger (OpenTelemetry)  | åˆ†å¸ƒå¼è°ƒç”¨é“¾ç›‘æ§                   |
| **éƒ¨ç½²**     | Docker & Docker Compose | å®¹å™¨åŒ–ç¼–æ’                         |

## ğŸ“‚ é¡¹ç›®ç»“æ„ (Directory Structure)

**Bash**

```
go-ecommerce/
â”œâ”€â”€ apps/                   # å¾®æœåŠ¡æºç 
â”‚   â”œâ”€â”€ gateway/            # [å…¥å£] API ç½‘å…³ (Gin + Sentinel + OTEL)
â”‚   â”œâ”€â”€ user/               # ç”¨æˆ·æœåŠ¡ (gRPC + MySQL)
â”‚   â”œâ”€â”€ product/            # å•†å“æœåŠ¡ (gRPC + MySQL + ES + Redis)
â”‚   â”œâ”€â”€ order/              # è®¢å•æœåŠ¡ (gRPC + MySQL + RabbitMQ)
â”‚   â”œâ”€â”€ cart/               # è´­ç‰©è½¦æœåŠ¡ (gRPC + Redis)
â”‚   â”œâ”€â”€ payment/            # æ”¯ä»˜æœåŠ¡ (gRPC + Mock)
â”‚   â””â”€â”€ address/            # åœ°å€æœåŠ¡ (gRPC + MySQL)
â”œâ”€â”€ pkg/                    # å…¬å…±åŒ… (é…ç½®ã€DBã€Tracerã€Response)
â”œâ”€â”€ proto/                  # Protobuf å®šä¹‰æ–‡ä»¶ (.proto)
â”œâ”€â”€ scripts/                # å·¥å…·è„šæœ¬ (å¦‚å‹æµ‹è„šæœ¬)
â”œâ”€â”€ docker-compose-full.yml # å®Œæ•´ç¯å¢ƒéƒ¨ç½²æ–‡ä»¶
â”œâ”€â”€ go.mod                  # ä¾èµ–ç®¡ç†
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜
```

## âš¡ï¸ å¿«é€Ÿå¼€å§‹ (Quick Start)

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿æœ¬åœ°å·²å®‰è£…ï¼š

* **Docker & Docker Compose** (æ ¸å¿ƒä¾èµ–)
* Go 1.20+ (ä»…å¼€å‘è°ƒè¯•éœ€è¦ï¼Œè¿è¡Œåªéœ€ Docker)

### 2. ä¸€é”®å¯åŠ¨

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š

**PowerShell**

```
# å¯åŠ¨æ‰€æœ‰åŸºç¡€è®¾æ–½(DB, MQ, ESç­‰)å’Œå¾®æœåŠ¡
docker-compose -f docker-compose-full.yml up -d --build
```

> âš ï¸  **æ³¨æ„** ï¼šåˆæ¬¡å¯åŠ¨éœ€è¦æ‹‰å–é•œåƒå’Œç¼–è¯‘ Go ä»£ç ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿã€‚å¦‚æœé‡åˆ° MySQL ç«¯å£å†²çªï¼Œè¯·ç¡®ä¿æœ¬åœ° MySQL å·²å…³é—­ã€‚

### 3. æœåŠ¡éªŒè¯

å¯åŠ¨æˆåŠŸåï¼Œå¯è®¿é—®ä»¥ä¸‹åœ°å€ï¼š

* **å‰ç«¯/API ç½‘å…³** : `http://localhost:8080` (Vue å‰ç«¯é¡µé¢)
* **Consul æ§åˆ¶å°** : `http://localhost:8500` (æŸ¥çœ‹æœåŠ¡æ³¨å†ŒçŠ¶æ€)
* **RabbitMQ æ§åˆ¶å°** : `http://localhost:15672` (è´¦å·/å¯†ç : guest/guest)
* **Jaeger è¿½è¸ª** : `http://localhost:16686`

---

## ğŸ§ª æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨æŒ‡å—

### 1. åŸºç¡€æµç¨‹

å‰ç«¯é¡µé¢å·²é›†æˆå®Œæ•´æµç¨‹ï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ“ä½œï¼š

1. **æ³¨å†Œ/ç™»å½•** ï¼šåˆ›å»ºæ–°è´¦å·ã€‚
2. **æµè§ˆå•†å“** ï¼šæ”¯æŒå…³é”®è¯æœç´¢ï¼ˆES é«˜äº®ï¼‰ã€‚
3. **è´­ç‰©è½¦** ï¼šæ·»åŠ å•†å“ã€ç»“ç®—ã€‚
4. **ä¸‹å•æ”¯ä»˜** ï¼šé€‰æ‹©åœ°å€ -> æäº¤è®¢å• -> æ¨¡æ‹Ÿæ”¯ä»˜ã€‚

### 2. ğŸ”¥ é«˜å¹¶å‘ç§’æ€æµ‹è¯• (Seckill)

ç§’æ€é€»è¾‘é‡‡ç”¨  **Redis å‰ç½®æ‹¦æˆª** ï¼Œå› æ­¤åœ¨æµ‹è¯•å‰å¿…é¡» **é¢„çƒ­åº“å­˜** ã€‚

**ç¬¬ä¸€æ­¥ï¼šé¢„çƒ­åº“å­˜ (Redis)**

å‡è®¾æˆ‘ä»¬è¦æµ‹è¯• SKU ID ä¸º `1` çš„å•†å“ç§’æ€ï¼š

**PowerShell**

```
# è¿›å…¥ Redis å®¹å™¨
docker exec -it deploy-redis redis-cli

# è®¤è¯ (å¦‚æœè®¾ç½®äº†å¯†ç )
auth root

# è®¾ç½® SKU ID=1 çš„åº“å­˜ä¸º 100 ä¸ª
SET seckill:stock:1 100

# (å¯é€‰) æ¸…é™¤è¯¥å•†å“çš„è´­ä¹°è®°å½•ï¼Œå…è®¸é‡å¤æµ‹è¯•
DEL seckill:user:1
```

**ç¬¬äºŒæ­¥ï¼šè¿›è¡Œç§’æ€**

åœ¨å‰ç«¯å•†å“è¯¦æƒ…é¡µç‚¹å‡»çº¢è‰² **â€œç«‹å³ç§’æ€â€** æŒ‰é’®ï¼Œæˆ–è€…è¿è¡Œå‹æµ‹è„šæœ¬ï¼š

**Bash**

```
# æ¨¡æ‹Ÿ 50 ä¸ªç”¨æˆ·å¹¶å‘æŠ¢è´­ (éœ€é…ç½® scripts/seckill_load.go)
go run scripts/seckill_load.go
```

### 3. å…¨é“¾è·¯è¿½è¸ª (Jaeger)

1. å‘èµ·ä»»æ„ API è¯·æ±‚ï¼ˆå¦‚æœç´¢å•†å“ã€ä¸‹å•ï¼‰ã€‚
2. è®¿é—® `http://localhost:16686`ã€‚
3. Service é€‰æ‹© `gateway` æˆ– `order-service`ï¼Œç‚¹å‡»  **Find Traces** ã€‚
4. æŸ¥çœ‹å®Œæ•´çš„è°ƒç”¨ç€‘å¸ƒå›¾ï¼Œåˆ†æå„ç¯èŠ‚è€—æ—¶ã€‚

---

## ğŸ› ï¸ å¼€å‘ä¸è¿ç»´å¸¸ç”¨å‘½ä»¤ (Cheat Sheet)

### Proto ä»£ç ç”Ÿæˆ

å½“ä½ ä¿®æ”¹äº† `.proto` æ–‡ä»¶åï¼Œéœ€è¦é‡æ–°ç”Ÿæˆ Go ä»£ç ï¼š

**Bash**

```
protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative proto/cart/cart.proto
# (æ ¹æ®éœ€è¦æ›¿æ¢å…·ä½“çš„ proto æ–‡ä»¶è·¯å¾„)
```

### Docker å®¹å™¨ç®¡ç†

**ğŸš€ å¯åŠ¨ä¸æ„å»º**

**PowerShell**

```
# åå°å¯åŠ¨æ‰€æœ‰æœåŠ¡ (æœ€å¸¸ç”¨)
docker-compose -f docker-compose-full.yml up -d

# ä¿®æ”¹ä»£ç åï¼Œé‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose -f docker-compose-full.yml up -d --build

# åªé‡å¯æŸä¸ªç‰¹å®šæœåŠ¡ (ä¾‹å¦‚åªé‡å¯ç½‘å…³)
docker-compose -f docker-compose-full.yml up -d gateway
```

**ğŸ›‘ åœæ­¢ä¸é‡å¯**

**PowerShell**

```
# åœæ­¢æ‰€æœ‰æœåŠ¡ (ä¿ç•™æ•°æ®å·)
docker-compose -f docker-compose-full.yml stop

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨ (æ¸…ç†ç¯å¢ƒï¼Œä½†ä¿ç•™ MySQL/ES æ•°æ®)
docker-compose -f docker-compose-full.yml down

# é‡å¯æŸä¸ªæœåŠ¡
docker-compose -f docker-compose-full.yml restart user-service
```

**ğŸ” æŸ¥çœ‹çŠ¶æ€ä¸æ—¥å¿—**

**PowerShell**

```
# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker-compose -f docker-compose-full.yml ps

# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose -f docker-compose-full.yml logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿— (åŠ ä¸Š --tail 100 é˜²æ­¢æ—¥å¿—å¤ªé•¿)
docker-compose -f docker-compose-full.yml logs -f --tail 100 order-service
```

**ğŸ§¹ æ•°æ®æ¸…ç† (é‡ç½®ç¯å¢ƒ)**

**PowerShell**

```
# âš ï¸ æ ¸å¼¹æ“ä½œï¼šåœæ­¢æœåŠ¡ + åˆ é™¤å®¹å™¨ + åˆ é™¤æ‰€æœ‰æ•°æ®å· (MySQLæ•°æ®ä¼šä¸¢å¤±ï¼)
docker-compose -f docker-compose-full.yml down -v

# ç²¾å‡†æ¸…é™¤ Elasticsearch ç´¢å¼•
docker exec deploy-elasticsearch curl -X DELETE http://localhost:9200/products

# ç²¾å‡†æ¸…é™¤ Redis æ‰€æœ‰ç¼“å­˜
docker exec deploy-redis redis-cli -a root FLUSHALL
```
